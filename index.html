<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N5.AI - Reality Drill V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #000; color: #fff; font-family: 'Courier New', monospace; overflow: hidden; }
        .glitch { text-shadow: 2px 0 #f00, -2px 0 #0f0; }
        input::placeholder { color: #333; }
        .timer-bar { transition: width 0.1s linear; }
        .hidden { display: none; }
        #user-input { caret-color: #f00; }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <!-- Screen 1: Home/Level Selection -->
    <div id="home-screen" class="text-center">
        <h1 class="text-5xl font-black mb-2 glitch">N5.AI DRILL</h1>
        <p class="text-zinc-600 text-[10px] tracking-[0.3em] mb-12 uppercase">Pilih level atau pulang.</p>
        
        <div class="flex flex-col gap-4 w-64 mx-auto">
            <button onclick="initGame(5)" class="border border-zinc-800 py-4 hover:bg-white hover:text-black transition-all font-bold text-xs">1. EASY (5s)</button>
            <button onclick="initGame(3)" class="border border-zinc-800 py-4 hover:bg-white hover:text-black transition-all font-bold text-xs">2. MID (3s)</button>
            <button onclick="initGame(2)" class="border border-red-600 py-4 text-red-600 hover:bg-red-600 hover:text-white transition-all font-bold text-xs">3. EKSTRIM (2s)</button>
        </div>
        <p class="mt-8 text-[8px] text-zinc-700 uppercase italic">Wajib keyboard Jepang. Romaji dilarang.</p>
    </div>

    <!-- Screen 2: Game UI -->
    <div id="game-screen" class="hidden w-full max-w-md flex flex-col items-center">
        <div class="w-full flex justify-between mb-2 font-mono text-[10px] text-zinc-500">
            <span id="stat-level">LEVEL: -</span>
            <span id="stat-score">SCORE: 00</span>
        </div>
        
        <!-- Timer -->
        <div class="w-full h-[2px] bg-zinc-900 mb-12">
            <div id="timer-line" class="timer-bar h-full bg-red-600 w-full"></div>
        </div>

        <!-- Kana Display -->
        <div id="kana-target" class="text-[12rem] font-black leading-none mb-8 transition-all">
            あ
        </div>

        <!-- User Visual Input -->
        <input type="text" id="user-input" 
               class="text-center text-7xl font-bold bg-transparent border-b-2 border-zinc-800 w-full pb-4 mb-4 uppercase" 
               autocomplete="off" spellcheck="false" autofocus>
        
        <p class="text-zinc-700 text-[9px] uppercase tracking-widest">Input karakter di atas</p>
    </div>

    <!-- Screen 3: Result -->
    <div id="result-screen" class="hidden text-center">
        <h2 id="result-msg" class="text-4xl font-black text-red-600 mb-2">GAGAL.</h2>
        <p id="result-score" class="text-zinc-500 text-sm mb-12">SKOR ASLI: 0</p>
        
        <div class="p-6 bg-zinc-900 mb-12 text-[10px] text-zinc-400 font-mono leading-relaxed">
            PROGRAM YANG LAIN AKAN HADIR DI MODUL YANG ADA,<br>
            PANTAU TERUS <span class="text-white font-bold">N5.AI</span>
        </div>

        <button onclick="resetToHome()" class="border-b border-white pb-1 text-xs font-bold uppercase hover:text-red-600 transition-colors">Coba Lagi</button>
    </div>

    <script>
        // Database & Logic Pintar
        const kanaPool = ['あ','い','う','え','お','か','き','く','け','こ','さ','し','す','せ','そ','た','ち','つ','て','と'];
        let failTracker = {}; // Melacak huruf yang lambat/salah
        
        let score = 0;
        let baseTime = 5;
        let timeLeft = 0;
        let timerId = null;
        let currentTarget = "";
        let startTime = 0;

        const ui = {
            home: document.getElementById('home-screen'),
            game: document.getElementById('game-screen'),
            result: document.getElementById('result-screen'),
            input: document.getElementById('user-input'),
            target: document.getElementById('kana-target'),
            timerLine: document.getElementById('timer-line'),
            score: document.getElementById('stat-score'),
            level: document.getElementById('stat-level')
        };

        function initGame(seconds) {
            baseTime = seconds;
            score = 0;
            ui.home.classList.add('hidden');
            ui.result.classList.add('hidden');
            ui.game.classList.remove('hidden');
            ui.level.innerText = `LEVEL: ${seconds === 2 ? 'EKSTRIM' : seconds === 3 ? 'MID' : 'EASY'}`;
            ui.score.innerText = `SCORE: 00`;
            spawnTarget();
            ui.input.focus();
        }

        function spawnTarget() {
            // AI Sederhana: Prioritaskan huruf yang pernah gagal/lambat (failTracker)
            let weightedPool = [...kanaPool];
            Object.keys(failTracker).forEach(k => {
                if(failTracker[k] > 1) weightedPool.push(k, k); // Duplikasi probabilitas
            });

            currentTarget = weightedPool[Math.floor(Math.random() * weightedPool.length)];
            ui.target.innerText = currentTarget;
            ui.input.value = "";
            
            startTimer();
        }

        function startTimer() {
            clearInterval(timerId);
            timeLeft = baseTime;
            startTime = Date.now();
            
            timerId = setInterval(() => {
                timeLeft -= 0.1;
                let percent = (timeLeft / baseTime) * 100;
                ui.timerLine.style.width = percent + "%";
                
                if(timeLeft <= 0) endGame("WAKTU HABIS");
            }, 100);
        }

        ui.input.addEventListener('input', (e) => {
            if(e.target.value === currentTarget) {
                let reactionTime = (Date.now() - startTime) / 1000;
                
                // Track performance
                if(!failTracker[currentTarget]) failTracker[currentTarget] = 0;
                if(reactionTime > baseTime * 0.7) failTracker[currentTarget]++; // Jika mepet, anggap susah
                else if(failTracker[currentTarget] > 0) failTracker[currentTarget]--;

                score++;
                ui.score.innerText = `SCORE: ${score.toString().padStart(2, '0')}`;
                spawnTarget();
            }
        });

        function endGame(msg) {
            clearInterval(timerId);
            ui.game.classList.add('hidden');
            ui.result.classList.remove('hidden');
            ui.result.querySelector('#result-msg').innerText = msg;
            ui.result.querySelector('#result-score').innerText = `PROGRES ASLI: ${score}`;
            
            // Logik pintar: Huruf terakhir yang gagal langsung masuk daftar hitam
            if(!failTracker[currentTarget]) failTracker[currentTarget] = 0;
            failTracker[currentTarget] += 2;
        }

        function resetToHome() {
            ui.result.classList.add('hidden');
            ui.home.classList.remove('hidden');
        }

        // Auto-focus handler
        document.addEventListener('click', () => {
            if(!ui.game.classList.contains('hidden')) ui.input.focus();
        });
    </script>
</body>
</html>

